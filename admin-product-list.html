<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Product List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind -->
  <link href="src/output.css" rel="stylesheet" />

  <style>
    body {
      font-family: "Inter", "Poppins", sans-serif;
      background: #fff6f6;
    }

    /* Smooth animation for mobile cards */
    .prod-card {
      transition: 0.2s ease;
    }
    .prod-card:hover {
      transform: translateY(-3px);
    }

    /* Toast animation */
    #toast {
      transition: all 0.4s ease;
    }
  </style>
</head>

<body class="text-gray-900 antialiased">

<!-- ================================================== -->
<!-- HEADER -->
<!-- ================================================== -->
<header class="sticky top-0 bg-white/90 backdrop-blur shadow border-b border-red-200 z-50">
  <nav class="max-w-7xl mx-auto px-4 lg:px-8 py-3 flex justify-between items-center">

    <div class="bg-[#6B0000] px-4 py-1.5 rounded-lg shadow">
      <span class="text-[#FFD600] font-extrabold text-sm tracking-wide">
        ADMIN PANEL – ALL PRODUCTS
      </span>
    </div>

    <a href="admin-dashboard.html"
      class="text-xs sm:text-sm font-semibold text-[#6B0000] 
      border border-[#FFD600] bg-[#FFD600]/80 px-3 py-1.5 rounded-full
      hover:bg-[#FFD600] transition">
      ← Dashboard
    </a>

  </nav>
</header>


<!-- ================================================== -->
<!-- MAIN AREA -->
<!-- ================================================== -->
<main class="max-w-7xl mx-auto px-4 lg:px-8 py-6 space-y-6">

  <!-- CONTROL BAR -->
  <section class="flex flex-col sm:flex-row justify-between gap-4">

    <input id="searchInput"
      placeholder="Search product..."
      class="w-full sm:w-1/3 px-3 py-2 bg-white border border-red-200 rounded-lg
      focus:ring-2 focus:ring-[#FFD600]" />

    <select id="categoryFilter"
      class="w-full sm:w-40 px-3 py-2 bg-white border border-red-200 rounded-lg
      focus:ring-2 focus:ring-[#FFD600]">
      <option value="all">All Categories</option>
    </select>

    <select id="sortSelect"
      class="w-full sm:w-40 px-3 py-2 bg-white border border-red-200 rounded-lg
      focus:ring-2 focus:ring-[#FFD600]">
      <option value="default">Sort: Default</option>
      <option value="low-high">Price Low → High</option>
      <option value="high-low">Price High → Low</option>
    </select>

  </section>

  <!-- PRODUCT COUNT -->
  <p id="productCount" class="text-sm text-gray-600"></p>

  <!-- DESKTOP TABLE -->
  <section class="hidden md:block">
    <table class="w-full bg-white rounded-xl overflow-hidden shadow border border-red-200">
      <thead class="bg-red-100 text-[#6B0000]">
        <tr>
          <th class="p-3 text-left text-sm font-bold">Image</th>
          <th class="p-3 text-left text-sm font-bold">Name</th>
          <th class="p-3 text-left text-sm font-bold">Price</th>
          <th class="p-3 text-left text-sm font-bold">Category</th>
          <th class="p-3 text-left text-sm font-bold">Actions</th>
        </tr>
      </thead>
      <tbody id="productTable"></tbody>
    </table>
  </section>

  <!-- MOBILE GRID -->
  <section id="mobileList" class="grid md:hidden grid-cols-1 sm:grid-cols-2 gap-4"></section>

  <!-- EMPTY STATE -->
  <p id="emptyState" class="hidden text-center text-gray-500 py-10">
    No products found.
  </p>

</main>


<!-- ================================================== -->
<!-- TOAST -->
<!-- ================================================== -->
<div id="toast"
  class="fixed bottom-6 right-6 bg-[#6B0000] text-[#FFD600] text-sm
  px-4 py-2 rounded-full shadow-lg opacity-0 pointer-events-none">
  Deleted!
</div>


<!-- ================================================== -->
<!-- INLINE JS (MERGED) -->
<!-- ================================================== -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  const API_URL = "http://localhost:5000/api/products";

  // DOM ELEMENTS
  const searchInput = document.getElementById("searchInput");
  const categoryFilter = document.getElementById("categoryFilter");
  const sortSelect = document.getElementById("sortSelect");

  const productTable = document.getElementById("productTable");
  const mobileList = document.getElementById("mobileList");
  const productCount = document.getElementById("productCount");
  const emptyState = document.getElementById("emptyState");
  const toast = document.getElementById("toast");

  let allProducts = [];
  let filteredProducts = [];

  /* ----------------------------------------------------------
     LOAD ALL PRODUCTS FROM BACKEND
  ---------------------------------------------------------- */
  async function loadProducts() {
    try {
      const res = await fetch(API_URL);
      allProducts = await res.json();
      filteredProducts = [...allProducts];

      loadCategories();
      renderProducts();

    } catch (err) {
      console.error("Product load error:", err);
    }
  }

  loadProducts();


  /* ----------------------------------------------------------
     LOAD DYNAMIC CATEGORIES
  ---------------------------------------------------------- */
  function loadCategories() {
    const cats = [...new Set(allProducts.map(p => p.category))];

    cats.forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat;
      categoryFilter.appendChild(opt);
    });
  }


  /* ----------------------------------------------------------
     RENDER PRODUCTS ON TABLE + MOBILE GRID
  ---------------------------------------------------------- */
  function renderProducts() {

    const list = filteredProducts;

    productCount.textContent = `${list.length} products`;
    productTable.innerHTML = "";
    mobileList.innerHTML = "";

    if (list.length === 0) {
      emptyState.classList.remove("hidden");
      return;
    }

    emptyState.classList.add("hidden");

    // TABLE VIEW
    list.forEach(p => {
      const row = `
        <tr class="border-b">
          <td class="p-3"><img src="image/${p.image}" class="w-14 h-14 rounded-lg object-cover" /></td>
          <td class="p-3">${p.name}</td>
          <td class="p-3 font-semibold text-[#6B0000]">৳ ${p.price}</td>
          <td class="p-3">${p.category}</td>
          <td class="p-3">
            <a href="admin-edit-product.html?id=${p._id}"
              class="px-3 py-1 bg-yellow-300 rounded text-sm">Edit</a>
            <button data-id="${p._id}"
              class="delete-btn px-3 py-1 bg-red-600 text-white rounded text-sm">Delete</button>
          </td>
        </tr>
      `;
      productTable.insertAdjacentHTML("beforeend", row);
    });

    // MOBILE CARDS
    list.forEach(p => {
      const card = `
        <div class="prod-card bg-white border border-red-200 rounded-xl shadow p-3 space-y-2">
          <img src="image/${p.image}" class="w-full h-40 object-cover rounded-lg" />

          <h3 class="font-semibold">${p.name}</h3>
          <p class="text-[#6B0000] font-bold">৳ ${p.price}</p>
          <p class="text-sm text-gray-500">${p.category}</p>

          <div class="flex gap-2 pt-2">
            <a href="admin-edit-product.html?id=${p._id}"
              class="flex-1 bg-yellow-300 py-1 rounded text-center font-semibold">Edit</a>
            <button data-id="${p._id}"
              class="delete-btn flex-1 bg-red-600 text-white py-1 rounded font-semibold">Delete</button>
          </div>
        </div>
      `;
      mobileList.insertAdjacentHTML("beforeend", card);
    });

    initDeleteActions();
  }


  /* ----------------------------------------------------------
     APPLY FILTERS (Search + Category + Sort)
  ---------------------------------------------------------- */
  function applyFilters() {
    let list = [...allProducts];

    const searchTxt = searchInput.value.toLowerCase();
    const cat = categoryFilter.value;
    const sort = sortSelect.value;

    // Search
    if (searchTxt) {
      list = list.filter(p =>
        p.name.toLowerCase().includes(searchTxt)
      );
    }

    // Category filter
    if (cat !== "all") {
      list = list.filter(p => p.category === cat);
    }

    // Sorting
    if (sort === "low-high") {
      list.sort((a, b) => a.price - b.price);
    } else if (sort === "high-low") {
      list.sort((a, b) => b.price - a.price);
    }

    filteredProducts = list;
    renderProducts();
  }

  searchInput.addEventListener("input", applyFilters);
  categoryFilter.addEventListener("change", applyFilters);
  sortSelect.addEventListener("change", applyFilters);


  /* ----------------------------------------------------------
     DELETE PRODUCT
  ---------------------------------------------------------- */
  function initDeleteActions() {
    document.querySelectorAll(".delete-btn").forEach(btn => {
      btn.onclick = async () => {
        const id = btn.dataset.id;

        if (!confirm("Delete this product?")) return;

        try {
          const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });

          if (!res.ok) throw new Error("Delete failed");

          showToast("Product Deleted!");

          allProducts = allProducts.filter(p => p._id !== id);
          applyFilters();

        } catch {
          showToast("Error deleting product!");
        }
      };
    });
  }


  /* ----------------------------------------------------------
     TOAST FUNCTION
  ---------------------------------------------------------- */
  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.remove("opacity-0", "pointer-events-none");
    toast.classList.add("opacity-100");

    setTimeout(() => {
      toast.classList.add("opacity-0");
      toast.classList.add("pointer-events-none");
    }, 1800);
  }

});
</script>

</body>
</html>
