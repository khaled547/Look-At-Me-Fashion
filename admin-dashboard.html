<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - Look At Me Fashion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind -->
  <link href="src/output.css" rel="stylesheet" />

  <style>
    body { font-family: "Inter", "Poppins", sans-serif; background:#fef2f2; }
    ::-webkit-scrollbar { width:5px; }
    ::-webkit-scrollbar-thumb { background:#e4bebe; border-radius:10px; }

    .card{background:#fff;padding:1rem;border-radius:16px;border:1px solid #f3c2c2;
      box-shadow:0 4px 8px rgba(0,0,0,0.05);display:flex;flex-direction:column;gap:4px;}
    .card-top{display:flex;justify-content:space-between;font-size:12px;font-weight:600;color:#555;}
    .card-number{font-size:32px;font-weight:800;color:#6B0000;}
    .card-sub{font-size:11px;color:#666;}

    .panel{background:#fff;padding:1rem;border-radius:20px;border:1px solid #f3c2c2;
      box-shadow:0 4px 6px rgba(0,0,0,0.04);display:flex;flex-direction:column;}
    .panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;}
    .panel-title{font-size:18px;font-weight:800;color:#6B0000;}
    .panel-sub{font-size:11px;color:gray;}
    .panel-list{max-height:420px;overflow-y:auto;display:flex;flex-direction:column;gap:10px;}

    .search-input,.filter-input{
      border:1px solid #f3c2c2;padding:6px 12px;border-radius:9999px;font-size:11px;
    }

    .loading,.empty,.error{font-size:12px;padding:8px 0;}
  </style>

  <!-- Admin Guard -->
  <script>
    const token = localStorage.getItem("lmf_admin_token");
    const user = JSON.parse(localStorage.getItem("lmf_admin_user") || "{}");
    if (!token || !user || user.role !== "admin") {
      window.location.href = "admin-login.html";
    }
  </script>

</head>
<body class="text-gray-900 antialiased">

  <!-- HEADER -->
  <header class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b border-red-200 shadow-sm">
    <nav class="max-w-7xl mx-auto px-4 lg:px-8 flex items-center justify-between py-3">
      <div class="flex items-center gap-2">
        <div class="bg-[#6B0000] px-4 py-1.5 rounded-lg shadow">
          <span class="text-[#FFD600] font-extrabold text-xs sm:text-lg uppercase">
            LMF Admin
          </span>
        </div>
      </div>

      <button id="logoutBtn" class="text-xs font-semibold text-white bg-red-600 px-4 py-1.5 rounded-full hover:bg-red-700">
        Logout
      </button>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="max-w-7xl mx-auto px-4 lg:px-8 py-6 space-y-6">

    <!-- TITLE -->
    <section class="flex flex-col md:flex-row md:justify-between gap-3">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold text-[#6B0000]">Admin Dashboard</h1>
        <p class="text-xs text-gray-600 mt-1">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶ì ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</p>
      </div>

      <p id="adminDate" class="text-xs text-gray-500"></p>
    </section>

    <!-- SUMMARY CARDS -->
    <section class="grid grid-cols-2 md:grid-cols-4 gap-3">

      <div class="card">
        <div class="card-top"><span>Total Products</span><span>üì¶</span></div>
        <p id="totalProducts" class="card-number">0</p>
        <p class="card-sub">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</p>
      </div>

      <div class="card">
        <div class="card-top"><span>Total Orders</span><span>üßæ</span></div>
        <p id="totalOrders" class="card-number">0</p>
        <p class="card-sub">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</p>
      </div>

      <div class="card">
        <div class="card-top"><span>Pending</span><span>‚è≥</span></div>
        <p id="pendingOrders" class="card-number text-orange-600">0</p>
        <p class="card-sub">‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ñ‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡ßü‡¶®‡¶ø</p>
      </div>

      <div class="card">
        <div class="card-top"><span>Revenue</span><span>üí∞</span></div>
        <p id="totalRevenue" class="card-number text-emerald-700">‡ß≥ 0</p>
        <p class="card-sub">‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p>
      </div>

    </section>

    <!-- PANELS -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">

      <!-- ORDERS PANEL -->
      <div class="panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">Recent Orders</h2>
            <p class="panel-sub">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</p>
          </div>

          <select id="orderFilter" class="filter-input">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="processing">Processing</option>
            <option value="completed">Completed</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>

        <div id="ordersLoading" class="loading">Loading orders...</div>
        <div id="ordersError" class="error hidden">Orders API error</div>
        <div id="ordersList" class="panel-list hidden"></div>
        <p id="ordersEmpty" class="empty hidden">‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>
      </div>

      <!-- PRODUCTS PANEL -->
      <div class="panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">Products</h2>
            <p class="panel-sub">‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</p>
          </div>

          <input id="productSearchInput" type="text" placeholder="Search..." class="search-input">
        </div>

        <div id="productsLoading" class="loading">Loading products...</div>
        <div id="productsError" class="error hidden">Products API error</div>
        <div id="productsList" class="panel-list hidden"></div>
        <p id="productsEmpty" class="empty hidden">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á‡•§</p>
      </div>

    </section>

  </main>

  <!-- JS SCRIPT INSIDE HTML -->
  <script>
    const API_BASE = "http://localhost:5000/api";
    const adminToken = localStorage.getItem("lmf_admin_token");

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("lmf_admin_token");
      localStorage.removeItem("lmf_admin_user");
      window.location.href = "admin-login.html";
    });

    // DATE
    document.getElementById("adminDate").textContent = new Date().toLocaleDateString("bn-BD", {
      weekday:"short",year:"numeric",month:"short",day:"numeric"
    });

    // SUMMARY
    function fetchSummary() {
      fetch(`${API_BASE}/admin/summary`, {
        headers: { Authorization: `Bearer ${adminToken}` }
      })
      .then(r=>r.json())
      .then(data=>{
        totalProducts.textContent = data.totalProducts ?? 0;
        totalOrders.textContent   = data.totalOrders ?? 0;
        pendingOrders.textContent = data.pendingOrders ?? 0;
        totalRevenue.textContent  = `‡ß≥ ${data.totalSales ?? 0}`;
      });
    }

    // PRODUCTS
    function fetchProducts() {
      productsLoading.classList.remove("hidden");

      fetch(`${API_BASE}/products`, {
        headers:{ Authorization:`Bearer ${adminToken}` }
      })
      .then(r=>r.json())
      .then(data=>{
        const list = document.getElementById("productsList");
        list.innerHTML="";
        data.forEach(p=>{
          list.innerHTML += `
            <div class="flex items-center gap-3 border border-red-100 rounded-2xl px-3 py-2 bg-white">
              <img src="image/${p.image || ''}" onerror="this.src='https://via.placeholder.com/50'" class="w-10 h-10 rounded-lg object-cover">
              <div class="flex-1">
                <p class="text-sm font-semibold">${p.name}</p>
                <p class="text-[10px] text-gray-500">${p.category}</p>
              </div>
              <p class="font-bold text-[#6B0000] text-sm">‡ß≥ ${p.price}</p>
            </div>`;
        });
        productsList.classList.remove("hidden");
      })
      .catch(()=>{
        productsError.classList.remove("hidden");
      })
      .finally(()=> productsLoading.classList.add("hidden"));
    }

    // ORDERS
    function fetchOrders() {
      ordersLoading.classList.remove("hidden");

      fetch(`${API_BASE}/orders`, {
        headers:{ Authorization:`Bearer ${adminToken}` }
      })
      .then(r=>r.json())
      .then(data=>{
        const list = document.getElementById("ordersList");
        list.innerHTML="";

        data.forEach(o=>{
          list.innerHTML += `
            <div class="border border-red-100 rounded-2xl px-3 py-3 bg-red-50">
              <div class="flex justify-between text-sm">
                <p><strong>Order:</strong> #${String(o._id).slice(-6)}</p>
                <p><strong>‡ß≥ ${o.total || o.amount}</strong></p>
              </div>
              <p class="text-xs text-gray-700">${o.customerName}</p>
              <p class="text-[10px] text-gray-500">üìû ${o.phone}</p>
            </div>`;
        });

        ordersList.classList.remove("hidden");
      })
      .catch(()=>{
        ordersError.classList.remove("hidden");
      })
      .finally(()=> ordersLoading.classList.add("hidden"));
    }

    // INIT
    fetchSummary();
    fetchProducts();
    fetchOrders();

    // Filters
    document.getElementById("orderFilter").addEventListener("change", () => {
      fetchOrders();
    });

    document.getElementById("productSearchInput").addEventListener("input", (e)=>{
      const q = e.target.value.toLowerCase();
      document.querySelectorAll("#productsList div").forEach(row=>{
        row.style.display = row.innerText.toLowerCase().includes(q) ? "" : "none";
      });
    });
  </script>

</body>
</html>
