<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - Look At Me Fashion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind CSS -->
  <link href="src/output.css" rel="stylesheet" />

  <style>
    body {
      font-family: "Inter", "Poppins", sans-serif;
      background: #fff6f6;
    }

    /* Mobile Smooth Scroll */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-thumb {
      background: #e4bebe;
      border-radius: 10px;
    }

    /* Premium Card Style */
    .card {
      background: #fff;
      padding: 1rem;
      border-radius: 18px;
      border: 1px solid #f4caca;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      display:flex;
      flex-direction:column;
      gap:4px;
      transition: .2s;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.08);
    }

    /* Dashboard Panel */
    .panel {
      background:#fff;
      padding:1rem;
      border-radius:20px;
      border:1px solid #f4caca;
      box-shadow:0 4px 8px rgba(0,0,0,0.05);
    }

  </style>

  <!-- Admin Guard -->
  <script>
    const token = localStorage.getItem("lmf_admin_token");
    const adminUser = JSON.parse(localStorage.getItem("lmf_admin_user") || "{}");

    if (!token || adminUser.role !== "admin") {
      window.location.href = "admin-login.html";
    }
  </script>

</head>

<body class="text-gray-900 antialiased">

<!-- =============================== -->
<!-- HEADER                         -->
<!-- =============================== -->
<header class="sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-red-200 shadow">
  <nav class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">

    <div class="bg-[#6B0000] px-4 py-1.5 rounded-lg shadow">
      <span class="text-[#FFD600] font-extrabold text-sm sm:text-lg uppercase">
        LMF ADMIN
      </span>
    </div>

    <button id="logoutBtn" class="bg-red-600 text-white font-semibold text-xs px-4 py-1.5 rounded-full hover:bg-red-700">
      Logout
    </button>

  </nav>
</header>


<!-- =============================== -->
<!-- MAIN SECTION                   -->
<!-- =============================== -->
<main class="max-w-7xl mx-auto px-4 py-6 space-y-8">

  <!-- TITLE -->
  <section class="flex flex-col md:flex-row md:justify-between items-start gap-3">
    <div>
      <h1 class="text-3xl md:text-4xl font-extrabold text-[#6B0000]">Admin Dashboard</h1>
      <p class="text-xs text-gray-600">‡¶∏‡¶ï‡¶≤ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
    </div>
    <p id="adminDate" class="text-xs text-gray-500"></p>
  </section>


  <!-- =============================== -->
  <!-- SUMMARY CARDS                  -->
  <!-- =============================== -->
  <section class="grid grid-cols-2 md:grid-cols-4 gap-4">

    <!-- Total Products -->
    <div class="card">
      <div class="flex justify-between text-xs"><span>Products</span>üì¶</div>
      <p id="totalProducts" class="text-3xl font-extrabold text-[#6B0000]">0</p>
      <p class="text-[11px] text-gray-500">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶™‡¶£‡ßç‡¶Ø</p>
    </div>

    <!-- Total Orders -->
    <div class="card">
      <div class="flex justify-between text-xs"><span>Orders</span>üßæ</div>
      <p id="totalOrders" class="text-3xl font-extrabold text-[#6B0000]">0</p>
      <p class="text-[11px] text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</p>
    </div>

    <!-- Pending Orders -->
    <div class="card">
      <div class="flex justify-between text-xs"><span>Pending</span>‚è≥</div>
      <p id="pendingOrders" class="text-3xl font-extrabold text-orange-600">0</p>
      <p class="text-[11px] text-gray-500">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶£ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</p>
    </div>

    <!-- Revenue -->
    <div class="card">
      <div class="flex justify-between text-xs"><span>Revenue</span>üí∞</div>
      <p id="totalRevenue" class="text-3xl font-extrabold text-emerald-700">‡ß≥ 0</p>
      <p class="text-[11px] text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p>
    </div>

  </section>


  <!-- =============================== -->
  <!-- ORDERS + PRODUCT PANELS        -->
  <!-- =============================== -->
  <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- Recent Orders Panel -->
    <div class="panel">
      <div class="flex justify-between items-center mb-3">
        <div>
          <h2 class="text-xl font-extrabold text-[#6B0000]">Recent Orders</h2>
          <p class="text-[11px] text-gray-500">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</p>
        </div>
        <select id="orderFilter" class="border border-red-200 px-3 py-1 rounded-full text-xs">
          <option value="all">All</option>
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="paid">Paid</option>
          <option value="shipped">Shipped</option>
        </select>
      </div>

      <!-- Status -->
      <p id="ordersLoading" class="text-xs text-gray-500">Loading orders...</p>
      <p id="ordersError" class="hidden text-xs text-red-600">Failed to load orders üö´</p>
      <p id="ordersEmpty" class="hidden text-xs text-gray-500">‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>

      <div id="ordersList" class="flex flex-col gap-3 max-h-[420px] overflow-y-auto hidden"></div>
    </div>


    <!-- Products Panel -->
    <div class="panel">
      <div class="flex justify-between items-center mb-3">
        <div>
          <h2 class="text-xl font-extrabold text-[#6B0000]">Products</h2>
          <p class="text-[11px] text-gray-500">‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</p>
        </div>
        <input id="productSearch" placeholder="Search..." class="border border-red-200 px-3 py-1 rounded-full text-xs" />
      </div>

      <!-- Status -->
      <p id="productsLoading" class="text-xs text-gray-500">Loading products...</p>
      <p id="productsError" class="hidden text-xs text-red-600">Failed to load products üö´</p>
      <p id="productsEmpty" class="hidden text-xs text-gray-500">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á‡•§</p>

      <div id="productsList" class="flex flex-col gap-3 max-h-[420px] overflow-y-auto hidden"></div>
    </div>

  </section>
</main>


<!-- =============================== -->
<!-- INLINE JAVASCRIPT               -->
<!-- =============================== -->
<script>
  const API = "http://localhost:5000/api";
  const adminToken = localStorage.getItem("lmf_admin_token");

  // Show Current Date
  document.getElementById("adminDate").textContent =
    new Date().toLocaleDateString("bn-BD", {
      weekday: "short",
      year: "numeric",
      month: "short",
      day: "numeric",
    });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("lmf_admin_token");
    localStorage.removeItem("lmf_admin_user");
    window.location.href = "admin-login.html";
  });

  // =====================================================
  // FETCH SUMMARY
  // =====================================================
  function loadSummary() {
    fetch(`${API}/admin/summary`, {
      headers: { Authorization: `Bearer ${adminToken}` },
    })
      .then((r) => r.json())
      .then((d) => {
        totalProducts.textContent = d.summary?.totalProducts ?? 0;
        totalOrders.textContent = d.summary?.totalOrders ?? 0;
        pendingOrders.textContent = d.summary?.orderStatus?.pending ?? 0;
        totalRevenue.textContent = `‡ß≥ ${d.summary?.totalSales ?? 0}`;
      });
  }

  // =====================================================
  // LOAD PRODUCTS
  // =====================================================
  function loadProducts() {
    productsLoading.classList.remove("hidden");

    fetch(`${API}/products`)
      .then((r) => r.json())
      .then((items) => {
        productsList.innerHTML = "";

        if (!items.length) {
          productsEmpty.classList.remove("hidden");
          return;
        }

        items.forEach((p) => {
          productsList.innerHTML += `
            <div class="border border-red-100 bg-white rounded-xl p-3 flex items-center gap-3">
              <img src="image/${p.image}" class="w-10 h-10 rounded-lg object-cover" />
              <div class="flex-1">
                <p class="font-semibold text-sm">${p.name}</p>
                <p class="text-[10px] text-gray-500">${p.category}</p>
              </div>
              <p class="font-bold text-[#6B0000] text-sm">‡ß≥ ${p.price}</p>
            </div>
          `;
        });

        productsList.classList.remove("hidden");
      })
      .catch(() => productsError.classList.remove("hidden"))
      .finally(() => productsLoading.classList.add("hidden"));
  }

  // Search Product
  document.getElementById("productSearch").addEventListener("input", (e) => {
    const q = e.target.value.toLowerCase();
    document.querySelectorAll("#productsList div").forEach((row) => {
      row.style.display = row.innerText.toLowerCase().includes(q) ? "" : "none";
    });
  });

  // =====================================================
  // LOAD ORDERS
  // =====================================================
  function loadOrders() {
    ordersLoading.classList.remove("hidden");

    fetch(`${API}/orders`)
      .then((r) => r.json())
      .then((orders) => {
        ordersList.innerHTML = "";

        if (!orders.length) {
          ordersEmpty.classList.remove("hidden");
          return;
        }

        orders.forEach((o) => {
          ordersList.innerHTML += `
            <div class="border border-red-100 bg-red-50 rounded-xl p-3">
              <div class="flex justify-between text-sm">
                <span>Order #${String(o._id).slice(-6)}</span>
                <span class="font-bold">‡ß≥ ${o.totalAmount}</span>
              </div>
              <p class="text-xs text-gray-800">üë§ ${o.customerName}</p>
              <p class="text-[10px] text-gray-500">üìû ${o.phone}</p>
            </div>
          `;
        });

        ordersList.classList.remove("hidden");
      })
      .catch(() => ordersError.classList.remove("hidden"))
      .finally(() => ordersLoading.classList.add("hidden"));
  }


  // INIT LOADERS
  loadSummary();
  loadProducts();
  loadOrders();

</script>

</body>
</html>
