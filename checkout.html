<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Checkout - Look At Me Fashion</title>

  <!-- Mobile Friendly -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Premium Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&
               family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />

  <!-- Tailwind CSS -->
  <link href="src/output.css" rel="stylesheet"/>

  <style>
    body { font-family: "Inter","Poppins",sans-serif; }
    * { -webkit-tap-highlight-color: transparent; }
  </style>
</head>

<body class="bg-red-50 text-gray-900">

  <!-- ===================================================== -->
  <!-- HEADER -->
  <!-- ===================================================== -->
  <header class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b border-red-200 shadow-sm">
    <nav class="max-w-7xl mx-auto px-4 lg:px-8 py-3 flex justify-between items-center">

      <div class="bg-[#6B0000] px-4 py-1.5 rounded-lg shadow active:scale-95 transition">
        <span class="text-[#FFD600] font-extrabold text-xs sm:text-lg tracking-wide">
          LOOK AT ME FASHION
        </span>
      </div>

      <a href="cart.html"
        class="text-xs sm:text-sm font-semibold text-[#6B0000] border border-[#FFD600]
               bg-[#FFD600]/80 px-3 py-1.5 rounded-full hover:bg-[#FFD600] 
               active:scale-95 transition">
        ← Back to Cart
      </a>
    </nav>
  </header>

  <!-- ===================================================== -->
  <!-- MAIN CONTENT -->
  <!-- ===================================================== -->
  <main class="max-w-7xl mx-auto px-4 lg:px-8 py-8 space-y-6">

    <!-- Page Title -->
    <h1 class="text-3xl sm:text-4xl font-extrabold text-[#6B0000]">
      Checkout
    </h1>

    <!-- CUSTOMER INFO FORM -->
    <section class="bg-white rounded-2xl shadow border border-red-200 p-5 grid sm:grid-cols-2 gap-4">

      <!-- Full Name -->
      <div>
        <label class="text-xs font-semibold text-gray-700">Full Name</label>
        <input id="name" type="text"
          class="w-full mt-1 px-3 py-2 border rounded-lg bg-white focus:ring-2 focus:ring-[#FFD600]"
          placeholder="Enter your name" />
      </div>

      <!-- Phone -->
      <div>
        <label class="text-xs font-semibold text-gray-700">Phone Number</label>
        <input id="phone" type="text"
          class="w-full mt-1 px-3 py-2 border rounded-lg bg-white focus:ring-2 focus:ring-[#FFD600]"
          placeholder="01XXXXXXXXX" />
      </div>

      <!-- Address -->
      <div class="sm:col-span-2">
        <label class="text-xs font-semibold text-gray-700">Full Address</label>
        <textarea id="address" rows="3"
          class="w-full mt-1 px-3 py-2 border rounded-lg bg-white focus:ring-2 focus:ring-[#FFD600]"
          placeholder="House, Road, Area, City"></textarea>
      </div>

    </section>

    <!-- ORDER SUMMARY BOX -->
    <section class="bg-white rounded-2xl shadow border border-red-200 p-5">

      <h2 class="text-xl font-bold text-[#6B0000] mb-3">Order Summary</h2>

      <div id="checkoutItems" class="space-y-3"></div>

      <div class="flex justify-between font-semibold text-lg mt-4">
        <span>Total:</span>
        <span id="checkoutTotal" class="text-[#6B0000] font-extrabold">৳ 0</span>
      </div>
    </section>

    <!-- PLACE ORDER BUTTON -->
    <button id="placeOrderBtn"
      class="w-full bg-[#FFD600] text-[#6B0000] font-bold py-3 rounded-full 
             shadow hover:bg-white border border-[#FFD600] active:scale-95 transition">
      Confirm Order →
    </button>

  </main>

  <!-- ===================================================== -->
  <!-- INLINE CHECKOUT JS (MERGED + CLEAN + PRO LEVEL) -->
  <!-- ===================================================== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      /* ------------------------------------------------------
         AUTH CHECK → User must be logged in
      ------------------------------------------------------ */
      const CART_KEY = "lmf_cart";
      const token = localStorage.getItem("lmf_token");
      const user = JSON.parse(localStorage.getItem("lmf_user") || "null");

      if (!token || !user) {
        window.location.href = "login.html";
        return;
      }

      /* ------------------------------------------------------
         DOM Elements
      ------------------------------------------------------ */
      const checkoutItems = document.getElementById("checkoutItems");
      const checkoutTotal = document.getElementById("checkoutTotal");
      const placeOrderBtn = document.getElementById("placeOrderBtn");

      const nameInput = document.getElementById("name");
      const phoneInput = document.getElementById("phone");
      const addressInput = document.getElementById("address");

      let cart = [];

      /* ------------------------------------------------------
         Load Cart
      ------------------------------------------------------ */
      function loadCart() {
        try {
          cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
        } catch {
          cart = [];
        }
      }

      /* ------------------------------------------------------
         Render Order Summary
      ------------------------------------------------------ */
      function renderCheckout() {
        loadCart();
        checkoutItems.innerHTML = "";

        if (cart.length === 0) {
          checkoutItems.innerHTML = `
            <p class="text-center text-gray-500 py-6">Your cart is empty.</p>
          `;
        }

        let total = 0;

        cart.forEach(item => {
          total += item.price * item.qty;

          checkoutItems.innerHTML += `
            <div class="flex items-center justify-between bg-red-50 p-3 rounded-xl border border-red-100 shadow-sm">
              <span class="font-medium text-gray-800">${item.name} × ${item.qty}</span>
              <span class="text-[#6B0000] font-semibold">৳ ${item.price * item.qty}</span>
            </div>
          `;
        });

        checkoutTotal.textContent = "৳ " + total;
      }

      renderCheckout();

      /* ------------------------------------------------------
         PLACE ORDER
      ------------------------------------------------------ */
      placeOrderBtn.addEventListener("click", async () => {

        const name = nameInput.value.trim();
        const phone = phoneInput.value.trim();
        const address = addressInput.value.trim();

        if (!name || !phone || !address) {
          alert("Please fill all fields.");
          return;
        }

        if (cart.length === 0) {
          alert("Your cart is empty.");
          return;
        }

        const totalAmount = Number(checkoutTotal.textContent.replace("৳", "").trim());

        // Backend Order Format
        const orderData = {
          customerName: name,
          phone,
          address,
          items: cart.map(item => ({
            id: item.id,
            name: item.name,
            qty: item.qty,
            price: item.price,
            image: item.image
          })),
          totalAmount: totalAmount,
          status: "pending"
        };

        // Send Order to Backend
        try {
          const res = await fetch("http://localhost:5000/api/orders", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify(orderData)
          });

          const data = await res.json();

          if (!res.ok) {
            alert(data.message || "Order failed!");
            return;
          }

          // Clear cart & Redirect
          localStorage.removeItem(CART_KEY);
          window.location.href = `order-success.html?orderId=${data._id}`;

        } catch (err) {
          console.error(err);
          alert("Order failed. Try again.");
        }
      });

    });
  </script>

</body>
</html>
