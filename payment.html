<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Payment - Look At Me Fashion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="src/output.css" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body { font-family: "Poppins", sans-serif; background: #fff5f5; }
  </style>
</head>

<body>

<header class="sticky top-0 bg-white/95 border-b border-red-200 shadow z-50">
  <nav class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="index.html">
      <div class="bg-[#6B0000] px-4 py-1.5 rounded-lg shadow">
        <span class="text-[#FFD600] font-extrabold text-sm tracking-wide">
          LOOK AT ME FASHION
        </span>
      </div>
    </a>
    <a href="checkout.html"
       class="text-xs font-semibold text-[#6B0000] border border-[#FFD600] bg-[#FFD600]/80 px-3 py-1.5 rounded-full">
      ‚Üê Back
    </a>
  </nav>
</header>

<main class="max-w-4xl mx-auto px-4 py-8">

  <h1 class="text-3xl font-extrabold text-[#6B0000] mb-6">
    Complete Payment üí≥
  </h1>

  <!-- Order Summary -->
  <div class="bg-white border border-red-200 rounded-2xl shadow p-5 mb-6">
    <h2 class="text-xl font-bold text-[#6B0000] mb-3">Order Summary</h2>

    <p class="text-sm text-gray-700">Order ID:
      <span id="orderId" class="font-bold"></span>
    </p>

    <p class="text-lg mt-2 font-bold text-[#6B0000]">
      Total: ‡ß≥ <span id="orderTotal"></span>
    </p>
  </div>

  <!-- Payment Method -->
  <div class="bg-white border border-red-200 rounded-2xl shadow p-5">
    <h2 class="text-xl font-bold text-[#6B0000] mb-4">Select Payment Method</h2>

    <div class="space-y-3">

      <!-- COD -->
      <label class="flex items-center gap-3 p-3 rounded-xl border border-red-200 cursor-pointer bg-red-50">
        <input type="radio" name="paymentMethod" value="cod" class="w-4 h-4" checked />
        <span class="font-medium">Cash on Delivery (COD)</span>
      </label>

      <!-- Bkash -->
      <label class="flex items-center gap-3 p-3 rounded-xl border border-red-200 cursor-pointer bg-white">
        <input type="radio" name="paymentMethod" value="bkash" class="w-4 h-4" />
        <span class="font-medium">bKash Payment</span>
      </label>

      <!-- Nagad -->
      <label class="flex items-center gap-3 p-3 rounded-xl border border-red-200 cursor-pointer bg-white">
        <input type="radio" name="paymentMethod" value="nagad" class="w-4 h-4" />
        <span class="font-medium">Nagad Payment</span>
      </label>

      <!-- Rocket -->
      <label class="flex items-center gap-3 p-3 rounded-xl border border-red-200 cursor-pointer bg-white">
        <input type="radio" name="paymentMethod" value="rocket" class="w-4 h-4" />
        <span class="font-medium">Rocket Payment</span>
      </label>

    </div>

    <!-- Optional Number Input -->
    <div id="trxBox" class="hidden mt-4">
      <p class="text-sm mb-2 font-medium">Enter Transaction ID</p>
      <input id="trxId"
             class="w-full p-2 border border-red-200 rounded-lg"
             placeholder="Example: BKASH123456" />
    </div>

    <button
      id="confirmPaymentBtn"
      class="mt-6 w-full bg-[#FFD600] text-[#6B0000] font-bold py-2.5 rounded-xl shadow hover:bg-white border border-[#FFD600] transition">
      Confirm Payment
    </button>

  </div>

</main>

<!-- JS -->
<script>
  const token = localStorage.getItem("lmf_token");
  const API_CONFIRM = "http://localhost:5000/api/orders/payment-confirm";

  const urlParams = new URLSearchParams(window.location.search);
  const orderId = urlParams.get("orderId");

  document.getElementById("orderId").textContent = orderId || "N/A";

  // Load total price from localStorage (temporary checkout storage)
  const tempOrder = JSON.parse(localStorage.getItem("lmf_temp_order"));
  document.getElementById("orderTotal").textContent = tempOrder?.total ?? "0";

  const trxBox = document.getElementById("trxBox");
  const confirmBtn = document.getElementById("confirmPaymentBtn");

  // Show TRX box only for digital payments
  document.querySelectorAll("input[name='paymentMethod']").forEach(radio => {
    radio.addEventListener("change", () => {
      if (radio.value === "cod") trxBox.classList.add("hidden");
      else trxBox.classList.remove("hidden");
    });
  });

  // Confirm payment logic
  confirmBtn.addEventListener("click", async () => {
    const method = document.querySelector("input[name='paymentMethod']:checked").value;

    let trxId = null;
    if (method !== "cod") {
      trxId = document.getElementById("trxId").value.trim();
      if (!trxId) {
        alert("Please enter Transaction ID!");
        return;
      }
    }

    const payload = {
      orderId: orderId,
      paymentMethod: method,
      transactionId: trxId
    };

    try {
      const res = await fetch(API_CONFIRM, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!res.ok) {
        alert(data.message || "Payment failed!");
        return;
      }

      // Redirect success page
      window.location.href = `order-success.html?orderId=${orderId}`;

    } catch (err) {
      console.error(err);
      alert("Payment failed! Try again.");
    }

  });
</script>

</body>
</html>
